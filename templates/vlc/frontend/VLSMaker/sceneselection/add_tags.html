<div id="separateSlide" class="wrapper">
    
    <div class="guide">
        <span class="guide-title">Separate Words To Add Multiple Cips </span>
        <span class="guide-icon" title="To Select Multiple Clips On This Line, Place Your Cursor Where You Want To Separate The Words, Type '/' To Separate The Words. When Done, Click The Done Button.">?</span>
    </div>

    <div class="tag-box">
        <ul id="list-of-tags" class="list-of-tags">
            <input class="tag-input" id="words" value="" type="text">
        </ul>
        <input id="id" name="id" hidden type="number">
    </div>
    <div id="error-message" class="error-message"></div>
    <div class="details">
        <button id="reset-btn" type="button">Reset</button>
        <button id="done-btn" type="button"></button>
    </div>
</div>

<script>
   const listOfTags = document.getElementById('list-of-tags');
    const input = listOfTags.querySelector('input');
    const resetBtn = document.getElementById('reset-btn');
    const doneBtn = document.getElementById('done-btn');
    let initialValue = input.value;
    const errorMessage = document.getElementById('error-message');
    function createTag(text) {
        const li = document.createElement('li');
        li.textContent = text;
        listOfTags.insertBefore(li, input);
    }

    function updateClipCount() {
        const tags = document.querySelectorAll('.list-of-tags li'); 
        const remainingText = input.value.trim();

        let clipCount = tags.length;  
        if (remainingText) {
            clipCount += 1;  
        }
        
        const doneBtn = document.getElementById('done-btn');
        doneBtn.textContent = `Proceed To Add ${clipCount} Clip${clipCount > 1 ? 's' : ''}`;
    }

    function handleKeyPress(e) {
        const value = input.value;
        let cursorPosition = input.selectionStart;  

        function moveToWordStart(pos) {
            while (pos > 0 && value[pos - 1] === ' ') {
                pos--;  
            }
            while (pos > 0 && value[pos - 1] !== ' ') {
                pos--;  
            }
            return pos;
        }

        function moveToWordEnd(pos) {
            while (pos < value.length && value[pos] === ' ') {
                pos++;  
            }
            while (pos < value.length && value[pos] !== ' ') {
                pos++;  
            }
            return pos;
        }

        if (e.key === 'ArrowLeft') {
            e.preventDefault();
            cursorPosition = moveToWordStart(cursorPosition);
            input.setSelectionRange(cursorPosition, cursorPosition); 
        }
        else if (e.key === 'ArrowRight') {
            e.preventDefault();
            cursorPosition = moveToWordEnd(cursorPosition);
            input.setSelectionRange(cursorPosition, cursorPosition);  
        }
        else if (e.key === '/') {
            const isAtValidPosition =
                cursorPosition === value.length || 
                value[cursorPosition - 1] === ' ' ||  
                (cursorPosition > 0 && value[cursorPosition] === ' '); 

            if (!isAtValidPosition) {
                e.preventDefault(); 
                errorMessage.textContent = 'Wrong Position To Separate Words';
                return;
            }

            e.preventDefault();
            const beforeCursor = value.substring(0, cursorPosition).trim();
            if (beforeCursor) createTag(beforeCursor);
            errorMessage.textContent = '';

            input.value = value.substring(cursorPosition).trim();
            updateClipCount();  
        }
        else if (e.key === 'Enter') {
            const isAtValidPosition =
                cursorPosition === value.length ||
                value[cursorPosition - 1] === ' ' ||  
                (cursorPosition > 0 && value[cursorPosition] === ' ');

            if (!isAtValidPosition) {
                e.preventDefault(); 
                errorMessage.textContent = 'Wrong Position To Separate Words';
                return;
            }

            e.preventDefault();
            const beforeCursor = value.substring(0, cursorPosition).trim();
            const afterCursor = value.substring(cursorPosition).trim();

            if (beforeCursor) createTag(beforeCursor);
            if (afterCursor) createTag(afterCursor);
            errorMessage.textContent = '';

            input.value = ''; 
            updateClipCount();
        }
    }

 
    function preventUnwantedKeys(e) {
        const allowedKeys = [
            'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Enter', '/'
        ];

        
        if (!allowedKeys.includes(e.key)) {
            e.preventDefault();
        }
    }

    function resetTags() {
        
        const tags = listOfTags.querySelectorAll('li');
        tags.forEach(tag => tag.remove());
        input.value = initialValue;
        errorMessage.textContent=''
        doneBtn.textContent='Proceed To add 1 Clip'

    }

    function convertRemainingToTag() {
        const value = input.value.trim();
        if (value) {
            createTag(value);
            input.value = ''; 
            errorMessage.textContent=''
            document.getElementById('separateSlide').style.display='none'
            document.getElementById('chooseVideo').style.display='flex'

        }
    }

    input.addEventListener('keydown', handleKeyPress);
    input.addEventListener('keydown', preventUnwantedKeys);
    resetBtn.addEventListener('click', resetTags);
    doneBtn.addEventListener('click', convertRemainingToTag);

    input.addEventListener('paste', e => e.preventDefault());
</script>